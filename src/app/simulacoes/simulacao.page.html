<!-- src/app/simulacoes/simulacao.page.html -->
<section class="space-y-4">
  <h2 class="text-2xl font-bold">Simulação de Empréstimo</h2>

  <form class="card grid gap-3" (ngSubmit)="simular()">
    <div>
      <label class="label">Produto</label>
      <select
        class="input"
        [(ngModel)]="form.produtoId"
        name="produtoId"
        required
      >
        <option [ngValue]="null" disabled>Selecione</option>
        <option *ngFor="let p of produtos" [ngValue]="p.id">{{p.nome}}</option>
      </select>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <div>
        <label class="label">Valor do empréstimo</label>
        <input
          class="input"
          type="number"
          step="0.01"
          [(ngModel)]="form.valor"
          name="valor"
          required
          min="1"
        />
      </div>
      <div>
        <label class="label">Número de meses</label>
        <input
          class="input"
          type="number"
          [(ngModel)]="form.meses"
          name="meses"
          required
          min="1"
        />
      </div>
    </div>

    <div class="flex gap-2">
      <button class="btn" [disabled]="!valid()">Simular</button>
      <button type="button" class="btn-secondary" (click)="reset()">
        Limpar
      </button>
    </div>
  </form>

  <div *ngIf="result" class="space-y-3">
    <div class="card">
      <h3 class="text-lg font-semibold">Resultado</h3>
      <div class="text-sm text-gray-600">
        <div>Produto: <strong>{{result.produto.nome}}</strong></div>
        <div>Valor solicitado: <strong>{{money(form.valor)}}</strong></div>
        <div>Prazo: <strong>{{form.meses}} meses</strong></div>
        <div>
          Taxa efetiva mensal:
          <strong>{{percent(result.taxaEfetivaMensal)}}</strong>
        </div>
        <div>
          Parcela mensal: <strong>{{money(result.parcelaMensal)}}</strong>
        </div>
        <div>
          Valor total com juros:
          <strong>{{money(result.valorTotalComJuros)}}</strong>
        </div>
      </div>
    </div>

    <div class="card overflow-x-auto">
      <h3 class="text-lg font-semibold mb-2">Memória de cálculo</h3>
      <table class="w-full text-sm">
        <thead class="text-left border-b">
          <tr>
            <th class="py-2">Mês</th>
            <th>Parcela</th>
            <th>Juros</th>
            <th>Amortização</th>
            <th>Saldo</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let i of result.memoriaCalculo"
            class="border-b last:border-0"
          >
            <td class="py-1">{{i.mes}}</td>
            <td>{{money(i.parcela)}}</td>
            <td>{{money(i.juros)}}</td>
            <td>{{money(i.amortizacao)}}</td>
            <td>{{money(i.saldo)}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="error" class="text-sm text-red-600">{{error}}</div>
</section>
